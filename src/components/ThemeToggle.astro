<button
  id="theme-toggle"
  aria-label="Toggle dark mode"
  class="w-8 h-8 rounded-full flex items-center justify-center transition-colors bg-stone-800 text-stone-100 hover:bg-stone-700 dark:bg-stone-200 dark:text-stone-800 dark:hover:bg-stone-300"
>
  <span id="theme-icon-light" class="hidden dark:inline text-base leading-none"
    >&#9788;</span
  >
  <span id="theme-icon-dark" class="inline dark:hidden text-base leading-none"
    >&#9790;</span
  >
</button>

<script>
  function initTheme() {
    const toggle = document.getElementById("theme-toggle");
    const saved = localStorage.getItem("theme");
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)",
    ).matches;

    if (saved === "dark" || (!saved && prefersDark)) {
      document.documentElement.classList.add("dark");
    }

    toggle?.addEventListener("click", () => {
      const isDark = document.documentElement.classList.toggle("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });
  }
  initTheme();
  document.addEventListener("astro:after-swap", initTheme);
</script>
