---
import ThemeToggle from "./ThemeToggle.astro";

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/blog", label: "Blog" },
  { href: "/projects", label: "Projects" },
  { href: "/about", label: "About" },
  { href: "/links", label: "Links" },
  { href: "/contact", label: "Contact" },
];

const currentPath = Astro.url.pathname;
---

<header
  class="sticky top-0 z-50 bg-stone-50/80 dark:bg-stone-900/80 backdrop-blur-sm border-b border-stone-200 dark:border-stone-700"
>
  <nav class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
    <a
      href="/"
      class="font-serif text-xl font-bold text-stone-900 dark:text-stone-100 hover:text-accent dark:hover:text-accent transition-colors"
    >
      ffledgling
    </a>

    <!-- Desktop navigation -->
    <ul class="hidden md:flex gap-6 text-sm">
      {
        navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={[
                "transition-colors hover:text-accent",
                currentPath === link.href
                  ? "text-accent font-medium"
                  : "text-stone-600 dark:text-stone-400",
              ]}
            >
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>

    <!-- Desktop theme toggle -->
    <div class="hidden md:block">
      <ThemeToggle />
    </div>

    <!-- Mobile controls -->
    <div class="flex md:hidden items-center gap-3">
      <ThemeToggle />
      <button
        id="mobile-menu-toggle"
        aria-label="Toggle menu"
        aria-expanded="false"
        class="text-stone-600 hover:text-stone-900 dark:text-stone-400 dark:hover:text-stone-100 transition-colors"
      >
        <!-- Hamburger icon -->
        <svg
          id="hamburger-icon"
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <!-- Close (X) icon -->
        <svg
          id="close-icon"
          class="w-6 h-6 hidden"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile dropdown menu -->
  <div
    id="mobile-menu"
    class="hidden md:hidden border-t border-stone-200 dark:border-stone-700 bg-stone-50/95 dark:bg-stone-900/95 backdrop-blur-sm"
  >
    <ul class="max-w-4xl mx-auto px-4 py-3 flex flex-col gap-3 text-sm">
      {
        navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={[
                "block py-1 transition-colors hover:text-accent",
                currentPath === link.href
                  ? "text-accent font-medium"
                  : "text-stone-600 dark:text-stone-400",
              ]}
            >
              {link.label}
            </a>
          </li>
        ))
      }
    </ul>
  </div>
</header>

<script>
  function initMobileMenu() {
    const toggle = document.getElementById("mobile-menu-toggle");
    const menu = document.getElementById("mobile-menu");
    const hamburgerIcon = document.getElementById("hamburger-icon");
    const closeIcon = document.getElementById("close-icon");

    if (!toggle || !menu || !hamburgerIcon || !closeIcon) return;

    toggle.addEventListener("click", () => {
      const isOpen = menu.classList.toggle("hidden");
      // isOpen is true when "hidden" was added (menu closed)
      toggle.setAttribute("aria-expanded", String(!isOpen));
      hamburgerIcon.classList.toggle("hidden", !isOpen);
      closeIcon.classList.toggle("hidden", isOpen);
    });
  }

  initMobileMenu();
  document.addEventListener("astro:after-swap", initMobileMenu);
</script>
