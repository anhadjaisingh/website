---
import ThemeToggle from "./ThemeToggle.astro";

const navLinks = [
  { href: "/", label: "Home" },
  { href: "/blog", label: "Blog" },
  { href: "/annotations", label: "Annotations" },
  { href: "/projects", label: "Projects" },
];

const currentPath = Astro.url.pathname;
---

<header
  class="sticky top-0 z-50 bg-slate-50/80 dark:bg-[#0d1520]/85 backdrop-blur-sm border-b border-stone-200 dark:border-stone-700"
>
  <nav class="max-w-3xl mx-auto px-4 py-3 flex items-center justify-between">
    <a
      href="/"
      class="font-serif text-3xl font-bold text-stone-900 dark:text-stone-100 hover:text-accent dark:hover:text-accent transition-colors"
    >
      ffledgling
    </a>

    <!-- Desktop navigation -->
    <ul class="hidden md:flex items-center gap-6 text-base font-medium">
      {
        navLinks.map((link) => {
          const isActive =
            link.href === "/"
              ? currentPath === "/"
              : currentPath === link.href ||
                currentPath.startsWith(link.href + "/");
          return (
            <li>
              <a
                href={link.href}
                class:list={[
                  "transition-colors hover:text-accent",
                  isActive
                    ? "text-accent font-semibold"
                    : "text-stone-600 dark:text-stone-400",
                ]}
              >
                {link.label}
              </a>
            </li>
          );
        })
      }
      <li>
        <ThemeToggle />
      </li>
    </ul>

    <!-- Mobile controls -->
    <div class="flex md:hidden items-center gap-3">
      <ThemeToggle />
      <button
        id="mobile-menu-toggle"
        aria-label="Toggle menu"
        aria-expanded="false"
        class="text-stone-600 hover:text-stone-900 dark:text-stone-400 dark:hover:text-stone-100 transition-colors"
      >
        <!-- Hamburger icon -->
        <svg
          id="hamburger-icon"
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <!-- Close (X) icon -->
        <svg
          id="close-icon"
          class="w-6 h-6 hidden"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile dropdown menu -->
  <div
    id="mobile-menu"
    class="hidden md:hidden border-t border-stone-200 dark:border-stone-700 bg-slate-50/95 dark:bg-[#0d1520]/95 backdrop-blur-sm"
  >
    <ul
      class="max-w-3xl mx-auto px-4 py-3 flex flex-col gap-3 text-base font-medium"
    >
      {
        navLinks.map((link) => {
          const isActive =
            link.href === "/"
              ? currentPath === "/"
              : currentPath === link.href ||
                currentPath.startsWith(link.href + "/");
          return (
            <li>
              <a
                href={link.href}
                class:list={[
                  "block py-1 transition-colors hover:text-accent",
                  isActive
                    ? "text-accent font-semibold"
                    : "text-stone-600 dark:text-stone-400",
                ]}
              >
                {link.label}
              </a>
            </li>
          );
        })
      }
    </ul>
  </div>
</header>

<script>
  function initMobileMenu() {
    const toggle = document.getElementById("mobile-menu-toggle");
    const menu = document.getElementById("mobile-menu");
    const hamburgerIcon = document.getElementById("hamburger-icon");
    const closeIcon = document.getElementById("close-icon");

    if (!toggle || !menu || !hamburgerIcon || !closeIcon) return;

    toggle.addEventListener("click", () => {
      const isOpen = menu.classList.toggle("hidden");
      // isOpen is true when "hidden" was added (menu closed)
      toggle.setAttribute("aria-expanded", String(!isOpen));
      hamburgerIcon.classList.toggle("hidden", !isOpen);
      closeIcon.classList.toggle("hidden", isOpen);
    });
  }

  initMobileMenu();
  document.addEventListener("astro:after-swap", initMobileMenu);
</script>
